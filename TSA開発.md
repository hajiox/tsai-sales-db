# レシピシステム開発 (TSA開発ログ)

## 概要
レシピデータの同期、食材（水）のマスター統合、重量原価の自動計算、および本番環境へのデプロイ管理。

## 1. プロジェクト概要
本プロジェクトは、従来Vercel上でブラウザベースで開発されていた販売管理KPI分析システムを、ローカル環境（C:\作業用\tsai-sales-db）で開発運用できるように環境構築を行ったものです。
DBはSupabase、AI分析にはGoogle Gemini API、認証にはNextAuth.js（Google認証）を使用しています。

## 2. 開発履歴
(省略...)

### 2026-02-17 17:29:27 ウマーボー丼のデータ修正
- Excelスクリーンショットに基づき「生姜(煮済み)」および「山椒パウダー」を追加
- 全ての材料の分量をExcelと100%一致するように同期
- 重量を再計算し本番環境へデプロイ


### 2026-02-17 17:55:17 全レシピの材料数分量の一括同期
- Excel（自社OEMネット）全45シート以上の材料データをDBと完全同期
- 不足していた中身のないレシピ（牛バラカレー、大噴火カレー等）に材料25〜29件を自動追加
- 全てのレシピの重量をExcel実数に基づき再計算
- 本番環境へデプロイ


### 2026-02-17 18:01:10 レシピ詳細画面のレイアウト修正
- コンテナの最大幅をA4サイズ(210mm)から1400pxへ拡大
- 材料名（名称）カラムの最小幅を320pxへ拡張し、長い名称が途切れないように修正
- テーブルレイアウトを固定幅から自動調整に変更し、大画面での視認性を向上


### 2026-02-17 18:25:10 レシピデータ完全同期(221シート)
- 自社OEMネット専用の3ファイル、全221シートを走査
- 219件のレシピデータを完全同期（材料の追加更新削除重量再計算）
- マッチングロジック改善: 部分一致使用済みID除外で重複回避
- DB上の全レシピの材料数がExcelとほぼ完全一致


### 2026-02-18 17:34:00 Amazon手数料の諸経費からの分離
- recipesテーブルに`amazon_fee_enabled`カラム（BOOLEAN, DEFAULT false）を追加
- レシピ詳細ページにAmazon手数料のON/OFFトグルスイッチを追加
- ON時: 販売価格 x Amazon手数料率(%)が自動計算され原価に加算
- 原価内訳表示（材料資材経費 / Amazon手数料）を追加
- 諸経費に含まれていた旧「Amazon手数料」アイテムを計算から除外するロジック追加
- 保存時にamazon_fee_enabledフラグをDBに保存
