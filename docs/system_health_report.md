
# システム健全性診断レポート

## 1. 概要
ユーザー様よりご指摘いただいた「中間部品の利用状況が表示されない」問題を調査するため、システム内の全データ（2505件）を対象に整合性チェックを行いました。
その結果、Excelからのデータ移行に起因する**深刻なデータリンク切れ**が多数確認されました。

## 2. 診断結果
### 中間部品（【P】やスープ、たれ等）の紐付け状況
| 項目 | 件数 | 割合 | 状態 |
| :--- | :--- | :--- | :--- |
| **正常にリンクされている** | **34件** | 約3% | ✅ 正常 |
| **表記揺れ（自動補正可）** | **10件** | 約1% | ⚠️ 要注意（【P】の有無など） |
| **リンク切れ（追跡不能）** | **107件** | **約96%** | ❌ **深刻な不整合** |

※ 中間部品と思われるアイテム名（「スープ」「たれ」「【P】」等を含むもの）を対象に調査

### 具体的な不整合の例
以下のような名称の不一致により、システムが「同じもの」として認識できていません。

| レシピアイテム名（使われている側） | マスタ上の正式名称（推測） | 原因 |
| :--- | :--- | :--- |
| `【P】完全再現スープ 醤油（背脂）` | `完全再現スープ（背脂醤油）` | 語順とカッコの位置が違う |
| `【仕入】味噌スープ` | （該当なし？ `味噌スープ`？） | 【仕入】タグの有無 |
| `ブレンド醤油スープ` | `醤油スープ（ブレンド）` | 語順違い |
| `【P】自社製造ラー油（出来高2/3）` | `ラー油` | 補足情報（出来高2/3）が名前に含まれている |

## 3. 問題の根本原因
現在のシステムは、Excelのデータをそのまま**「文字列」**として取り込んでいます。
そのため、Excel上で「`チャーシュー（小）`」と入力したり「`チャーシュー小`」と入力したりしている部分が、全て「別の商品」として扱われています。
この状態では、どんなにプログラム側で検索ロジック（あいまい検索）を強化しても、正確な原価計算や利用状況の追跡は不可能です。

## 4. 推奨される改善案（ロードマップ）

この問題を解決し、正確なシステムにするためには、以下の3段階の改修が必要です。

### 【Phase 1】 データの「名寄せ」と紐付け（最優先）
現在の「文字列でつながっている状態」から「ID（管理番号）でつながっている状態」に移行するための準備です。
*   **アクション**: 「紐付いていないアイテム一覧」を表示し、正しいマスタデータ（レシピや原材料）を選択して紐付けるための**「データクレンジング画面」**を作成します。
*   **運用**: ユーザー様にて、この画面を使って「`【P】完全再現スープ 醤油（背脂）` は `完全再現スープ（背脂醤油）` のことです」と教えてあげる作業を行っていただきます。

### 【Phase 2】 データ構造の厳格化（システム改修）
*   **アクション**: データベースの構造を変更し、アイテム名（文字列）だけでなく、紐付けたIDを保存するようにします。
*   **効果**: これにより、今後名称変更があってもリンクが切れなくなります。

### 【Phase 3】 入力ミスの防止（UI改修）
*   **アクション**: レシピ登録・編集画面で、アイテム名を自由に手入力することを禁止し、基本的には**「マスタから選択する」**方式に変更します。
*   **効果**: 新たな表記揺れの発生を未然に防ぎます。

## 5. 次のアクション
まずは **Phase 1の「データクレンジング画面」の実装**をご提案します。
これにより、システム上のデータを整理し、正しい原価計算と利用状況の可視化が可能になります。
